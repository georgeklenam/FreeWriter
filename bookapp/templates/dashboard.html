{% extends 'base.html' %}
{% load static %}

{% block title %}
    <title>FreeWriter | Dashboard</title>
{% endblock %}

{% block content %}
<div class="dashboard-container">
    <!-- Dashboard Header -->
    <div class="dashboard-header">
        <div class="header-content">
            <h1 class="dashboard-title">
                <i class="fas fa-tachometer-alt"></i>
                {% if user_type == 'writer' %}Writer Dashboard{% else %}Reader Dashboard{% endif %}
            </h1>
            <p class="dashboard-subtitle">
                Welcome back, {{ user.username }}! 
                {% if user_type == 'writer' %}
                    Manage your uploaded books and track your success.
                {% else %}
                    Track your reading progress and reviews.
                {% endif %}
            </p>
        </div>
        <div class="user-type-badge">
            <i class="fas fa-{% if user_type == 'writer' %}pen-fancy{% else %}book-reader{% endif %}"></i>
            {{ user_type|title }}
        </div>
    </div>

    <!-- Stats Cards -->
    <div class="stats-grid">
        {% if user_type == 'writer' %}
            <!-- Writer Stats -->
            <div class="stat-card">
                <div class="stat-icon">
                    <i class="fas fa-book"></i>
                </div>
                <div class="stat-content">
                    <h3 class="stat-number">{{ total_books }}</h3>
                    <p class="stat-label">Books Uploaded</p>
                </div>
            </div>
            
            <div class="stat-card">
                <div class="stat-icon">
                    <i class="fas fa-star"></i>
                </div>
                <div class="stat-content">
                    <h3 class="stat-number">{{ total_ratings }}</h3>
                    <p class="stat-label">Total Ratings</p>
                </div>
            </div>
            
            <div class="stat-card">
                <div class="stat-icon">
                    <i class="fas fa-comment"></i>
                </div>
                <div class="stat-content">
                    <h3 class="stat-number">{{ total_reviews }}</h3>
                    <p class="stat-label">Total Reviews</p>
                </div>
            </div>
            
            <div class="stat-card">
                <div class="stat-icon">
                    <i class="fas fa-chart-line"></i>
                </div>
                <div class="stat-content">
                    <h3 class="stat-number">{{ average_rating }}/5</h3>
                    <p class="stat-label">Average Rating</p>
                </div>
            </div>
        {% else %}
            <!-- Reader Stats -->
            <div class="stat-card">
                <div class="stat-icon">
                    <i class="fas fa-book-open"></i>
                </div>
                <div class="stat-content">
                    <h3 class="stat-number">{{ total_books_read }}</h3>
                    <p class="stat-label">Books Read</p>
                </div>
            </div>
            
            <div class="stat-card">
                <div class="stat-icon">
                    <i class="fas fa-star"></i>
                </div>
                <div class="stat-content">
                    <h3 class="stat-number">{{ total_reviews_written }}</h3>
                    <p class="stat-label">Reviews Written</p>
                </div>
            </div>
            
            <div class="stat-card">
                <div class="stat-icon">
                    <i class="fas fa-chart-line"></i>
                </div>
                <div class="stat-content">
                    <h3 class="stat-number">{{ average_rating_given }}/5</h3>
                    <p class="stat-label">Average Rating Given</p>
                </div>
            </div>
            
            <div class="stat-card">
                <div class="stat-icon">
                    <i class="fas fa-clock"></i>
                </div>
                <div class="stat-content">
                    <h3 class="stat-number">{{ recently_read|length }}</h3>
                    <p class="stat-label">Recently Read</p>
                </div>
            </div>
        {% endif %}
    </div>

    <!-- Main Content -->
    <div class="dashboard-content">
        {% if user_type == 'writer' %}
            <!-- Writer Dashboard Content -->
            <div class="content-section">
                <div class="section-header">
                    <h2 class="section-title">
                        <i class="fas fa-upload"></i>
                        Your Uploaded Books
                    </h2>
                    <a href="{% url 'upload_book' %}" class="add-book-btn">
                        <i class="fas fa-plus"></i>
                        Upload New Book
                    </a>
                </div>
                
                {% if uploaded_books %}
                    <div class="books-grid">
                        {% for book in uploaded_books %}
                            <div class="book-card">
                                <div class="book-cover">
                                    {% if book.cover_image %}
                                        <img src="{{ book.cover_image.url }}" alt="{{ book.title }}" class="cover-image">
                                    {% else %}
                                        <div class="no-image">
                                            <i class="fas fa-book"></i>
                                            <span>No Image</span>
                                        </div>
                                    {% endif %}
                                </div>
                                <div class="book-info">
                                    <h3 class="book-title">{{ book.title }}</h3>
                                    <p class="book-author">{{ book.author }}</p>
                                    <div class="book-stats">
                                        <span class="stat">
                                            <i class="fas fa-star"></i>
                                            {{ book.average_rating|floatformat:1 }}/5
                                        </span>
                                        <span class="stat">
                                            <i class="fas fa-comment"></i>
                                            {{ book.review_count }}
                                        </span>
                                    </div>
                                    <div class="book-actions">
                                        <a href="{% url 'book_detail' book.slug %}" class="action-btn view-btn">
                                            <i class="fas fa-eye"></i>
                                            View
                                        </a>
                                        <a href="{% url 'read_book' book.slug %}" class="action-btn read-btn">
                                            <i class="fas fa-book-open"></i>
                                            Read
                                        </a>
                                    </div>
                                </div>
                            </div>
                        {% endfor %}
                    </div>
                {% else %}
                    <div class="empty-state">
                        <i class="fas fa-upload"></i>
                        <h3>No Books Uploaded Yet</h3>
                        <p>Start your writing journey by uploading your first book!</p>
                        <a href="{% url 'upload_book' %}" class="primary-btn">
                            <i class="fas fa-plus"></i>
                            Upload Your First Book
                        </a>
                    </div>
                {% endif %}
            </div>
        {% else %}
            <!-- Reader Dashboard Content -->
            <div class="content-section">
                <div class="section-header">
                    <h2 class="section-title">
                        <i class="fas fa-history"></i>
                        Recently Read Books
                    </h2>
                </div>
                
                {% if recently_read %}
                    <div class="books-grid">
                        {% for book in recently_read %}
                            <div class="book-card">
                                <div class="book-cover">
                                    {% if book.cover_image %}
                                        <img src="{{ book.cover_image.url }}" alt="{{ book.title }}" class="cover-image">
                                    {% else %}
                                        <div class="no-image">
                                            <i class="fas fa-book"></i>
                                            <span>No Image</span>
                                        </div>
                                    {% endif %}
                                </div>
                                <div class="book-info">
                                    <h3 class="book-title">{{ book.title }}</h3>
                                    <p class="book-author">{{ book.author }}</p>
                                    <div class="book-actions">
                                        <a href="{% url 'book_detail' book.slug %}" class="action-btn view-btn">
                                            <i class="fas fa-eye"></i>
                                            View Details
                                        </a>
                                        <a href="{% url 'read_book' book.slug %}" class="action-btn read-btn">
                                            <i class="fas fa-book-open"></i>
                                            Continue Reading
                                        </a>
                                    </div>
                                </div>
                            </div>
                        {% endfor %}
                    </div>
                {% else %}
                    <div class="empty-state">
                        <i class="fas fa-book-open"></i>
                        <h3>No Books Read Yet</h3>
                        <p>Start exploring books and rate them to see them here!</p>
                        <a href="{% url 'all_books' %}" class="primary-btn">
                            <i class="fas fa-search"></i>
                            Browse Books
                        </a>
                    </div>
                {% endif %}
            </div>
            
            <!-- User Reviews Section -->
            {% if user_reviews %}
                <div class="content-section">
                    <div class="section-header">
                        <h2 class="section-title">
                            <i class="fas fa-comment"></i>
                            Your Reviews
                        </h2>
                    </div>
                    
                    <div class="reviews-list">
                        {% for review in user_reviews %}
                            <div class="review-item">
                                <div class="review-header">
                                    <div class="reviewer-info">
                                        <div class="reviewer-avatar">
                                            <i class="fas fa-user-circle"></i>
                                        </div>
                                        <div class="reviewer-details">
                                            <h4 class="reviewer-name">{{ review.user.username }}</h4>
                                            <div class="review-rating">
                                                {% for i in "12345" %}
                                                    {% if forloop.counter <= review.rating %}
                                                        <i class="fas fa-star filled-star"></i>
                                                    {% else %}
                                                        <i class="far fa-star empty-star"></i>
                                                    {% endif %}
                                                {% endfor %}
                                            </div>
                                        </div>
                                    </div>
                                    <div class="review-date">
                                        {{ review.created_at|date:"M d, Y" }}
                                    </div>
                                </div>
                                <div class="review-content">
                                    <h5 class="review-title">{{ review.title }}</h5>
                                    <p class="review-text">{{ review.content }}</p>
                                    <div class="review-book">
                                        <i class="fas fa-book"></i>
                                        Review for: <a href="{% url 'book_detail' review.book.slug %}">{{ review.book.title }}</a>
                                    </div>
                                </div>
                            </div>
                        {% endfor %}
                    </div>
                </div>
            {% endif %}
        {% endif %}
    </div>
</div>
{% endblock %}
