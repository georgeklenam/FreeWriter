{% extends 'base.html' %}

{% block title %}
<title>FreeWriter | Search Books</title>
{% endblock %}

{% block content %}

<div class="search-page-container">
    <div class="page-header">
        <h1 class="page-title">
            <i class="fas fa-search"></i>
            Search Books
        </h1>
        <p class="page-subtitle">Discover your next favorite book with our intelligent search and powerful filtering system</p>
    </div>
    
    <!-- Search Form with Filters -->
    <div class="search-filters-section">
        <form method="POST" action="{% url 'book_search' %}" class="search-filters-form">
            {% csrf_token %}
            <div class="search-filters-grid">
                <div class="search-input-group">
                    <label for="search-query" class="filter-label">
                        <i class="fas fa-search"></i>
                        Search Query
                    </label>
                    <input type="text" 
                           id="search-query" 
                           name="name_of_book" 
                           class="search-input" 
                           placeholder="Search by title, author, or summary..." 
                           value="{{ query|default:'' }}"
                           required>
                </div>
                
                                 <div class="filter-group">
                     <label for="category-filter" class="filter-label">
                         <i class="fas fa-th-large"></i>
                         Category
                     </label>
                    <select id="category-filter" name="category" class="filter-select">
                        <option value="">All Categories</option>
                        {% for category in categories %}
                            <option value="{{ category.name }}" 
                                    {% if selected_category == category.name %}selected{% endif %}>
                                {{ category.name }}
                            </option>
                        {% endfor %}
                    </select>
                </div>
                
                <div class="filter-group">
                    <label for="author-filter" class="filter-label">
                        <i class="fas fa-user"></i>
                        Author
                    </label>
                    <select id="author-filter" name="author" class="filter-select">
                        <option value="">All Authors</option>
                        {% for author in authors %}
                            <option value="{{ author }}" 
                                    {% if selected_author == author %}selected{% endif %}>
                                {{ author }}
                            </option>
                        {% endfor %}
                    </select>
                </div>
                
                <div class="search-actions">
                    <button type="submit" class="search-btn-primary">
                        <i class="fas fa-search"></i>
                        Search
                    </button>
                    <a href="{% url 'book_search' %}" class="clear-filters-btn">
                        <i class="fas fa-times"></i>
                        Clear Filters
                    </a>
                </div>
            </div>
        </form>
    </div>
    
    <!-- Search Results -->
    {% if query or selected_category or selected_author %}
        <div class="search-results-header">
            <h2 class="results-title">
                <i class="fas fa-list"></i>
                Search Results
            </h2>
            {% if searched_books %}
                <div class="results-count">
                    <span class="count-number">{{ searched_books.count }}</span>
                    <span class="count-label">Books Found</span>
                </div>
                {% if query or selected_category or selected_author %}
                    <div class="active-filters">
                        <span class="filters-label">Active Filters:</span>
                        {% if query %}
                            <span class="filter-tag">
                                <i class="fas fa-search"></i>
                                "{{ query }}"
                                <a href="?{% if selected_category %}category={{ selected_category }}{% endif %}{% if selected_author %}{% if selected_category %}&{% endif %}author={{ selected_author }}{% endif %}" class="remove-filter">
                                    <i class="fas fa-times"></i>
                                </a>
                            </span>
                        {% endif %}
                        {% if selected_category %}
                            <span class="filter-tag">
                                <i class="fas fa-filter"></i>
                                {{ selected_category }}
                                <a href="?{% if query %}name_of_book={{ query }}{% endif %}{% if selected_author %}{% if query %}&{% endif %}author={{ selected_author }}{% endif %}" class="remove-filter">
                                    <i class="fas fa-times"></i>
                                </a>
                            </span>
                        {% endif %}
                        {% if selected_author %}
                            <span class="filter-tag">
                                <i class="fas fa-user"></i>
                                {{ selected_author }}
                                <a href="?{% if query %}name_of_book={{ query }}{% endif %}{% if selected_category %}{% if query %}&{% endif %}category={{ selected_category }}{% endif %}" class="remove-filter">
                                    <i class="fas fa-times"></i>
                                </a>
                            </span>
                        {% endif %}
                    </div>
                {% endif %}
            {% endif %}
        </div>
    {% endif %}
    
    <!-- Books Grid -->
    <div class="books-grid">
        {% if searched_books %}
            {% for book in searched_books %}
            <div class="book-card">
                <a href="{% url 'book_detail' book.slug %}" class="book-link">
                    <div class="book-cover">
                        {% if book.cover_image %}
                            <img src="{{book.cover_image.url}}" alt="{{book.title}}" class="cover-image">
                        {% else %}
                            <div class="no-image">
                                <i class="fas fa-book"></i>
                                <span>No Image</span>
                            </div>
                        {% endif %}
                        <div class="book-overlay">
                            <i class="fas fa-eye"></i>
                            <span>View Details</span>
                        </div>
                    </div>
                    <div class="book-info">
                        <h3 class="book-title">{{book.title}}</h3>
                        <p class="book-author">{{book.author}}</p>
                                             <div class="book-categories">
                         {% for category in book.category.all|slice:":2" %}
                             <span class="category-tag">
                                 <i class="{{category.icon}}"></i>
                                 {{category.name}}
                             </span>
                         {% endfor %}
                     </div>
                    </div>
                </a>
            </div>
            {% endfor %}
        {% else %}
            {% if query or selected_category or selected_author %}
                <div class="no-books">
                    <i class="fas fa-search"></i>
                    <h3>No Books Found</h3>
                    <p>Don't worry! Try adjusting your search terms or filters. Sometimes a broader search reveals hidden gems.</p>
                    <div class="no-books-actions">
                        <a href="{% url 'book_search' %}" class="btn-clear">
                            <i class="fas fa-times"></i>
                            Clear All Filters
                        </a>
                        <a href="{% url 'all_books' %}" class="btn-browse">
                            <i class="fas fa-book"></i>
                            Browse All Books
                        </a>
                    </div>
                </div>
            {% else %}
                <div class="search-instructions">
                    <i class="fas fa-search"></i>
                    <h3>Ready to Discover?</h3>
                    <p>Start your journey by entering a search term above. Find books by title, author, or summary, and use our smart filters to discover exactly what you're looking for.</p>
                    <div class="search-tips">
                        <h4>ðŸ’¡ Pro Tips for Better Results:</h4>
                        <ul>
                            <li><strong>Title Search:</strong> Try searching by book title or partial title</li>
                            <li><strong>Author Search:</strong> Search by author name for all their works</li>
                            <li><strong>Smart Filtering:</strong> Combine category and author filters for precision</li>
                            <li><strong>Case Insensitive:</strong> Your search works regardless of capitalization</li>
                            <li><strong>Partial Matches:</strong> You don't need to type the complete title</li>
                        </ul>
                    </div>
                </div>
            {% endif %}
        {% endif %}
    </div>
</div>

{% endblock %}